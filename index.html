<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>title</title>
    <script>
      var image;
      function makeShader(type, gl, source) {
        var shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
          console.log(gl.getShaderInfoLog(shader));
        }
        return shader;
      }
      function makeVertexShader(gl, source) {
        return makeShader(gl.VERTEX_SHADER, gl, source);
      }
      function makeFragmentShader(gl, source) {
        return makeShader(gl.FRAGMENT_SHADER, gl, source);
      }
      function makeTexture(gl, index, source, options) {
        if (options == undefined) options = {};
        if (options.target === undefined) options.target = gl.TEXTURE_2D;
        if (options.level === undefined) options.level = 0;
        if (options.internalFormat === undefined)
          options.internalFormat = gl.RGB;
        if (options.border === undefined) options.border = 0;
        if (options.format === undefined) options.format = gl.RGB;
        if (options.type === undefined) options.type = gl.UNSIGNED_BYTE;
        if (options.wrapS === undefined) options.wrapS = gl.CLAMP_TO_EDGE;
        if (options.wrapT === undefined) options.wrapT = gl.CLAMP_TO_EDGE;
        if (options.minFilter === undefined) options.minFilter = gl.LINEAR;
        gl.activeTexture(gl.TEXTURE0 + index);
        gl.bindTexture(gl.TEXTURE_2D, gl.createTexture());
        if (options.width === undefined && options.height === undefined) {
          gl.texImage2D(
            options.target, options.level, options.internalFormat,
            options.format, options.type, source
          );
        } else {
          gl.texImage2D(
            options.target, options.level, options.internalFormat,
            options.width, options.height, options.border,
            options.format, options.type, source
          );
        }
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, options.wrapS);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, options.wrapT);
        gl.texParameteri(
          gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, options.minFilter
        );
        return index;
      }
      function init() {
        var canvas = document.createElement("canvas");
        canvas.width = 600;
        canvas.height = 400;
        document.body.appendChild(canvas);
        gl = canvas.getContext("webgl");

        var shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, makeVertexShader(gl, `
          attribute vec2 vertexPosition;

          varying highp vec2 position;

          void main(void) {
            gl_Position = vec4(
              vec2(2.0, -2.0) * vertexPosition + vec2(-1.0, 1.0),
              0.0,
              1.0
            );
            position = vertexPosition;
          }
        `));
        gl.attachShader(shaderProgram, makeFragmentShader(gl, `
          precision highp float;
          varying vec2 position;

          uniform sampler2D image;
          uniform sampler2D offsetMap;

          void main(void) {
            float offset = texture2D(offsetMap, position).a;
            vec2 newPosition = position + vec2(0.0, offset);
            gl_FragColor = texture2D(image, newPosition);
          }
        `));
        gl.linkProgram(shaderProgram);
        gl.useProgram(shaderProgram);

        gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
          0.0,  0.0,
          0.0,  1.0,
          1.0,  0.0,
          1.0,  1.0
        ]), gl.STATIC_DRAW);
        gl.vertexAttribPointer(
            gl.getAttribLocation(shaderProgram, 'vertexPosition'),
            2, // numComponents
            gl.FLOAT, // type
            false, // normalize
            0, // stride
            0 // offset
        );
        gl.enableVertexAttribArray(
          gl.getAttribLocation(shaderProgram, 'vertexPosition')
        );

        image = document.getElementsByTagName("img")[0];
        gl.uniform1i(
          gl.getUniformLocation(shaderProgram, 'image'),
          makeTexture(gl, 0, image)
        );

        gl.getExtension("OES_texture_float");
        gl.getExtension("OES_texture_float_linear");

        offsetMap = new Float32Array(canvas.width * canvas.height);
        for (var x = 170; x < 250; x++) {
          for (var y = 50; y < 185; y++) {
            offsetMap[y * canvas.width + x] = 0.01;
          }
        }
        gl.uniform1i(
          gl.getUniformLocation(shaderProgram, 'offsetMap'),
          makeTexture(
            gl, 1, offsetMap, {
              internalFormat: gl.ALPHA,
              width: canvas.width,
              height: canvas.height,
              format: gl.ALPHA,
              type: gl.FLOAT
            }
          )
        );

        gl.drawArrays(
          gl.TRIANGLE_STRIP,
          0, // first
          4, // count
        );
      }
    </script>
  </head>
  <body onload="init()">
    <img src="textyour.png">
  </body>
</html>
