<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>title</title>
    <script>
      var image;
      function init() {
        var canvas = document.createElement("canvas");
        canvas.width = 600;
        canvas.height = 400;
        document.body.appendChild(canvas);
        gl = canvas.getContext("webgl");

        var shaderProgram = gl.createProgram();
        var vertexShader = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vertexShader, `
          attribute vec2 aTextureCoord;

          varying highp vec2 vTextureCoord;

          void main(void) {
            gl_Position = vec4(
              vec2(2.0, -2.0) * aTextureCoord + vec2(-1.0, 1.0),
              0.0,
              1.0
            );
            vTextureCoord = aTextureCoord;
          }
        `);
        gl.compileShader(vertexShader);
        if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {
          console.log(gl.getShaderInfoLog(vertexShader));
        }
        gl.attachShader(shaderProgram, vertexShader);
        var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fragmentShader, `
          precision highp float;
          varying vec2 vTextureCoord;

          uniform sampler2D uSampler;
          uniform sampler2D depthMap;

          void main(void) {
            float shift = texture2D(depthMap, vTextureCoord).a;
            vec2 shiftedCoord = vTextureCoord + vec2(0.0, shift);
            gl_FragColor = texture2D(uSampler, shiftedCoord);
          }
        `);
        gl.compileShader(fragmentShader);
        if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {
          console.log(gl.getShaderInfoLog(fragmentShader));
        }
        gl.attachShader(shaderProgram, fragmentShader);
        gl.linkProgram(shaderProgram);
        gl.useProgram(shaderProgram);

        gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
          0.0,  0.0,
          0.0,  1.0,
          1.0,  0.0,
          1.0,  1.0
        ]), gl.STATIC_DRAW);
        gl.vertexAttribPointer(
            gl.getAttribLocation(shaderProgram, 'aTextureCoord'),
            2, // numComponents
            gl.FLOAT, // type
            false, // normalize
            0, // stride
            0 // offset
        );
        gl.enableVertexAttribArray(
          gl.getAttribLocation(shaderProgram, 'aTextureCoord')
        );

        image = document.getElementsByTagName("img")[0];
        gl.activeTexture(gl.TEXTURE0); // texture unit 0
        gl.bindTexture(gl.TEXTURE_2D, gl.createTexture());
        gl.texImage2D(
          gl.TEXTURE_2D,
          0, // level
          gl.RGB, // internalFormat
          gl.RGB, // srcFormat
          gl.UNSIGNED_BYTE, // srcType
          image
        );
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
        gl.uniform1i(
          gl.getUniformLocation(shaderProgram, 'uSampler'),
          0 // texture unit 0
        );

        gl.getExtension("OES_texture_float");
        gl.getExtension("OES_texture_float_linear");

        depthMap = new Float32Array(canvas.width * canvas.height);
        for (var x = 170; x < 250; x++) {
          for (var y = 50; y < 185; y++) {
            depthMap[y * canvas.width + x] = 0.01;
          }
        }

        gl.activeTexture(gl.TEXTURE1); // texture unit 1
        gl.bindTexture(gl.TEXTURE_2D, gl.createTexture());
        gl.texImage2D(
          gl.TEXTURE_2D,
          0, // level
          gl.ALPHA, // internalFormat
          canvas.width,
          canvas.height,
          0, // border
          gl.ALPHA, // srcFormat
          gl.FLOAT, // srcType
          depthMap
        );
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
        gl.uniform1i(
          gl.getUniformLocation(shaderProgram, 'depthMap'),
          1 // texture unit 1
        );

        gl.drawArrays(
          gl.TRIANGLE_STRIP,
          0, // first
          4, // count
        );
      }
    </script>
  </head>
  <body onload="init()">
    <img src="textyour.png">
  </body>
</html>
